Copyright (C) Internet Systems Consortium, Inc. ("ISC")

See COPYRIGHT in the source root or http://isc.org/copyright.html for terms.

# DNSSEC Key and Signing Policy

A DNSSEC key and signing policy (KASP) defines a DNSSEC policy that can be
applied to one or more zones.

For some background information, see:

    https://www.ietf.org/archive/id/draft-mekking-dnsop-kasp-00.txt

# DNSSEC in BIND 9

DNSSEC is first implemented in BIND 9.  Many adaptations have been made since
then.  A lot of configuration knobs were added.  One aim with introducing KASP
configuration is that all these configuration options are grouped together.
Instead of configuring many different options per zone, you would be able to
do the following:

zone "example.com." {
    ...
    dnssec-policy "nsec3";
};

TODO: Explain how DNSSEC automated maintenance is done now.


## Existing DNSSEC configuration options

### Signing

The following configuration options exist nowadays for `named` to maintain
DNSSEC signed zones.  These will no longer work if an explicit DNSSEC policy
is set for a zone.

1. `auto-dnssec`: When setting a DNSSEC policy for a zone instead, the
   behavior will be as if `auto-dnssec` was set to `maintain`.

1. `dnskey-sig-validity`: This option will be replaced in favor of the KASP
   configuration value `signature-validity-dnskey`.

1. `dnssec-dnskey-kskonly`: This option will be removed and the key
   configuration from the policy will be used to determine what RRsets will be
   signed with which keys (Keys will have a role "KSK" and/or "ZSK", more on
   that later).

1. `dnssec-loadkeys-interval`: This option will determine how the period that
   BIND 9 will check its key repository (default once per hour) to see if
   there are new keys added or if existing keys metadata has changed.  This
   option actually can go away because the entity that performs DNSSEC
   maintenance knows exactly when the next step needs to happen.  This does
   mean that whenever a new key is added or deprecated manually, the timers
   need to be updated.

1. `dnssec-secure-to-insecure`: This option allows a dynamic zone to
   transition from secure to insecure.  This option will be removed and to
   transition to insecure with a DNSSEC policy you will just remove the
   `dnssec-policy` option from the zone configuration.

1. `dnssec-update-mode`: This option determines how DNSSEC signed dynamic
   zones are updated. Default is `maintain` and it is unclear how it is
   different from `auto-dnssec`.  With KASP, the behavior will be as if
   the `dnssec-update-mode` was set to `maintain`.  If you want DNSSEC
   maintenance to be done outside `named`, you should not configure a
   `dnssec-policy` for that zone.

1. `inline-signing`:  When set to "yes", this option will sign incoming
   unsigned zones.  This is also no longer needed when KASP is introduced
   because when setting a `dnssec-policy` for a secondary zone this indicates
   that `inline-signing` is desired.  Basically `inline-signing` is the 
   `auto-dnssec` for zones with a hidden master.

1. `max-zone-ttl`: This will cap all TTLs in a zone file to the specified
    value. Although this option may be used for non-DNSSEC zones, it is really
    only useful for DNSSEC-signed zones because when performing key rollovers
    the timing depends on the largest TTL in the zone.

1. `sig-signing-nodes`: This specifies the number of nodes to be examined
   in a quantum when signing a zone with a new DNSKEY. Why? This needs to go.

1. `sig-signing-signatures`: This specifies a threshold number of how many
   signatures will be generated in a quantum. What?

1. `sig-signing-type`: Internal record type number, used to track zone
   signing process.  This likely will go away in favor of a new method.

1. `sig-validity-interval`: Specifies the number of days a signature is valid.
   The second optional value is the refresh interval. Thos option will
   be replaced by KASP configuration values "signature-validity-default" and
   "signature-refresh".

1. `update-check-ksk`: When set to "no", KSK will also sign non-DNSKEY RRsets.
   This option will go away and key roles will be used to determine what
   keys sign which RRsets (A KSK that should sign all RRsets will have both
   the KSK and ZSK role).

Other DNSSEC related configuration options that are not related to the policy
are likely to stay:

1. `key-directory`: This is where the DNSKEY key files can be found.

1. `serial-update-method`: This is used for dynamic zones to determne how
   the SOA SERIAL should be updated.  There will likely be a separate
   configuration option for the serial update method when resigning a zone.


### Validation

To do

# KASP Configuration

The KASP Configuration may look something like this:

```
keystore "softhsm" {
    module "/usr/local/lib/libsofthsm.so";
    tokenlabel "BIND9";
    pin "1234";
    capacity 1000;
    require-backup no;
    skip-public-key yes;
};

dnssec-policy "nsec3" {

    description "policy for zones that require zone walking mitigation";

    signatures-resign PT2H;
    signatures-refresh P3D;
    signatures-validity P14D;
    signatures-validity-dnskey P14D;
    signatures-validity-denial P7D;
    signatures-jitter PT12H;
    signatures-inception-offset PT300S;

    denial-type nsec3;
    nsec3param-ttl PT0S;
    nsec3-optout no;
    nsec3-resalt P100D;
    nsec3-hash-algorithm 1;
    nsec3-hash-iterations 5;
    nsec3-salt-length 8;

    dnskey-ttl PT3600S;
    dnskey-publish-safety PT3600S;
    dnskey-retire-safety PT3600S;
    share-keys no;
    purge-keys-after P14D;

    keys {
	hsm "softhsm" \
		ksk P1Y offline manual ECDSAP256SHA256;
	directory "/etc/bind9/dnsseckeys/" \
		zsk P30D online  automatic ECDSAP256SHA256;
    };

    cds yes;
    cdnskey yes;

    zone-propagation-delay PT3600S;
    zone-soa-ttl PT3600S;
    zone-soa-minimum PT3600S;
    zone-soa-serial-update-method unixtime;
    zone-max-ttl PT24H;

    parent-propagation-delay PT24H;
    parent-ds-ttl PT3600S;
    parent-soa-ttl PT3600S;
    parent-soa-minimum PT3600S;
    check-ds { 127.0.0.53; };
    check-ds-interval PT3600S;
};
```

## Key roles

